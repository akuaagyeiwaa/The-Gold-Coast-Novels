```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eighteenpence - Gold Coast Novels</title>
    <!-- Add Google Translate Script -->
    <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <!-- Add to head section -->
<style>
    [data-theme="dark"] {
        --bg-color: #1a1a1a;
        --text-color: #ffffff;
        --accent-color: #F4C430;
        --secondary-bg: #333;
    }

    [data-theme="light"] {
        --bg-color: #ffffff;
        --text-color: #000000;
        --accent-color: #DAA520;
        --secondary-bg: #f5f5f5;
    }

    body {
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: all 0.3s ease;
    }

    .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px;
        border-radius: 50%;
        border: none;
        background: var(--accent-color);
        cursor: pointer;
        z-index: 1000;
    }
</style>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        header {
            background: #DAA520;
            color: #fff;
            padding: 1rem 0;
            text-align: center;
        }

        .back-nav {
            background: #444;
            padding: 0.5rem 0;
            text-align: left;
        }

        .back-nav a {
            color: #fff;
            text-decoration: none;
            margin-left: 20px;
            display: inline-block;
            padding: 5px 15px;
        }

        .back-nav a:hover {
            text-decoration: underline;
        }

        .tab-container {
            width: 100%;
            margin: 20px 0;
        }

        .tabs {
            display: flex;
            background: #DAA520;
            padding: 10px 0 0 0;
            margin: 0;
            justify-content: center;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            color: white;
            font-size: 16px;
            border-radius: 5px 5px 0 0;
        }

        .tab-button.active {
            background: #F4C430;
            color: black;
        }

        .tab-content {
            display: none;
            padding: 20px;
            background: #fff;
            border: 1px solid #DAA520;
            margin: 0 20px;
        }

        .tab-content.active {
            display: block;
        }

        footer {
            background: #333;
            color: #fff;
            text-align: center;
            padding: 1rem 0;
            margin-top: 2rem;
        }

        footer a {
            color: #fff;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Accordion Styles */
        .accordion {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }

        .accordion-item {
            border: 1px solid #ddd;
            margin-bottom: 5px;
        }

        .accordion-header {
            background: #F4C430;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 16px;
        }

        .accordion-header:hover {
            background: #DAA520;
        }

        .accordion-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #fff;
        }

        .accordion-content.active {
            max-height: 1000px; /* Adjust this value based on content length */
            padding: 15px;
        }

        .accordion-header::after {
            content: '+';
            font-size: 20px;
            font-weight: bold;
        }

        .accordion-header.active::after {
            content: '-';
        }
        /* Previous styles remain the same */

        /* Additional styles for new features */
        .tools-container {
            position: fixed;
            right: 20px;
            top: 100px;
            background: #fff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .tool-button {
            display: block;
            margin: 5px 0;
            padding: 8px 15px;
            background: #DAA520;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        .tool-button:hover {
            background: #F4C430;
        }

        .search-box {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
        }

        .search-box input {
            padding: 8px;
            width: 70%;
            margin-right: 10px;
        }

        .search-box button {
            padding: 8px 15px;
            background: #DAA520;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .search-results {
            margin-top: 15px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .highlight {
            background-color: yellow;
        }

        /* Read Aloud controls */
        .read-aloud-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            align-items: center;
        }

        .read-aloud-controls button {
            padding: 8px 15px;
            background: #DAA520;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .speed-control {
            padding: 5px;
        }
    </style>
<!-- Add to head -->
<style>
    .progress-container {
        position: fixed;
        top: 0;
        width: 100%;
        height: 4px;
        background: #f1f1f1;
        z-index: 1000;
    }

    .progress-bar {
        height: 4px;
        background: var(--accent-color);
        width: 0%;
    }
</style>
<!-- Add to head -->
<style>
    .share-buttons {
        position: fixed;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .share-button {
        padding: 10px;
        border-radius: 50%;
        border: none;
        background: var(--accent-color);
        cursor: pointer;
        color: white;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>
<!-- Add to head -->
<style>
    .toc {
        position: fixed;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        background: var(--secondary-bg);
        padding: 20px;
        border-radius: 10px;
        max-width: 250px;
        max-height: 80vh;
        overflow-y: auto;

</style>
<!-- Add to head -->
<style>
    .font-controls {
        position: fixed;
        right: 20px;
        bottom: 20px;
        background: var(--secondary-bg);
        padding: 10px;
        border-radius: 5px;
        display: flex;
        gap: 10px;
    }

    .font-button {
        padding: 5px 10px;
        background: var(--accent-color);
        border: none;
        border-radius: 3px;
        cursor: pointer;
        color: white;
    }
</style>
<!-- Add to head section -->
<style>
    .analytics-dashboard {
        position: fixed;
        right: 20px;
        bottom: 80px;
        background: var(--secondary-bg);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        display: none; /* Hidden by default */
        z-index: 1000;
    }

    .analytics-toggle {
        position: fixed;
        right: 20px;
        bottom: 20px;
        padding: 10px;
        background: var(--accent-color);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .analytics-chart {
        margin: 10px 0;
        padding: 10px;
        background: white;
        border-radius: 5px;
    }
</style>
</head>
<body data-theme="light">
    <!-- Add to body start -->
<div class="progress-container">
    <div class="progress-bar" id="readingProgress"></div>
</div>

    <!-- Add to body -->
<button class="theme-toggle" onclick="toggleTheme()">
    <span id="theme-icon">üåô</span>
</button>
    <header>
        <h1>Eighteenpence</h1>
    </header>
    <div class="back-nav">
        <a href="index.html">‚Üê Back to Home</a>
    </div>
    <main>
        <div class="tools-container">
            <div id="google_translate_element"></div>
            <button class="tool-button" onclick="toggleReadAloud()">Toggle Read Aloud</button>
            <button class="tool-button" onclick="document.getElementById('search-box').focus()">Search in Text</button>
        </div>

        <div class="tab-container">
            <div class="tabs">
                <button class="tab-button active" onclick="openTab(event, 'author')">The Author</button>
                <button class="tab-button" onclick="openTab(event, 'fulltext')">Full Text</button>
                <button class="tab-button" onclick="openTab(event, 'themes')">Themes</button>
                <button class="tab-button" onclick="openTab(event, 'characters')">Characters</button>
                <button class="tab-button" onclick="openTab(event, 'excerpts')">Excerpts</button>
                <button class="tab-button" onclick="openTab(event, 'immersive')">Immersive Reader</button>
            </div>

            <div id="author" class="tab-content active">
                <h2>Richarrd Emmanuel Obeng</h2>
                <div class="author-info">

                    <p>Richard Emmanuel Obeng was born in 1877 in Kwahu Abetifi to Daniel Kwadwo Donko Asare and Maria Akua Kuru Animwa. He began his formal education at a mission school in Abetifi, established by Swiss missionaries Reverend Werne and his wife, Ramseyer. Obeng later trained as a teacher at the mission seminary and subsequently embarked on a career as a ‚Äúteacher-cum-catechist,‚Äù serving initially in Basel Mission schools and later in the Government Teaching Service (Yitah and Dako, 362). His professional journey also led him into public administration, where he served as a court clerk at the District Magistrate Court in Abetifi.</p>

                    <p>Following his retirement from the judiciary, Obeng continued to serve his community as treasurer and clerk for the Kwahu state between 1939 and 1942. His firsthand experiences in these roles informed much of his literary work. Notably, Eighteenpence‚Äîhis seminal novel‚Äîis widely regarded as a fictionalized account of the sociopolitical and legal dynamics he observed during his tenure at the magistrate court.</p>
                    <p>and he was loved</p>

                </div>
            </div>

            <div id="fulltext" class="tab-content">
                <h2>Full Text</h2>
                <div class="accordion">
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 1: Introduction</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 1 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 2: The Beginning</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 2 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 3: The Journey</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 3 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 4: The Discovery</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 4 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 5: The Challenge</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 5 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 6: The Conflict</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 6 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 7: The Struggle</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 7 goes here...</p>
                        </div>
                    </div>
                    <div class<pad><pad><pad><pad><pad><pad><pad><pad>




















-item">
                        <button class="accordion-header">Chapter 8: The Revelation</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 8 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 9: The Decision</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 9 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 10: The Change</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 10 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 11: The Turn</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 11 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 12: The Path</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 12 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 13: The Choice</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 13 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 14: The Test</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 14 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 15: The Trial</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 15 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 16: The Victory</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 16 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 17: The Truth</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 17 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 18: The Climax</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 18 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 19: The Confrontation</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 19 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 20: Resolution</button>
                        <div class="accordion-content">
                            <p>Content for Chapter 20 goes here...</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header">Chapter 21: Epilogue</button>
                        <div class="accordion-content">
                            <p>Content for the Epilogue goes here...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="themes" class="tab-content">
                <h2>Themes</h2>
                <div class="themes-content">
                    <h3>Major Themes</h3>
                    <ul>
                        <li>Theme 1</li>
                        <li>Theme 2</li>
                        <li>Theme 3</li>
                    </ul>
                </div>
            </div>

            <div id="characters" class="tab-content">
                <h2>Characters</h2>
                <div class="characters-content">
                    <h3>Main Characters</h3>
                    <div class="character-list">
                        <p>Character descriptions go here...</p>
                    </div>
                </div>
            </div>

            <div id="excerpts" class="tab-content">
                <h2>Notable Excerpts</h2>
                <div class="excerpts-content">
                    <h3>Key Passages</h3>
                    <blockquote>
                        Example excerpt from the novel...
                    </blockquote>
                </div>
            </div>

            <!-- Add new Immersive Reader tab -->
            <div id="immersive" class="tab-content">
                <h2>Immersive Reader</h2>

                <div class="search-box">
                    <input type="text" id="search-box" placeholder="Search in text...">
                    <button onclick="searchText()">Search</button>
                    <div class="search-results" id="search-results"></div>
                </div>

                <div class="read-aloud-controls">
                    <button onclick="startReading()">Play</button>
                    <button onclick="pauseReading()">Pause</button>
                    <button onclick="stopReading()">Stop</button>
                    <select class="speed-control" onchange="changeReadingSpeed(this.value)">
                        <option value="0.8">Slow</option>
                        <option value="1.0" selected>Normal</option>
                        <option value="1.2">Fast</option>
                    </select>
                </div>

                <div id="immersive-content" class="immersive-text">
                    <!-- Content will be loaded from chapters dynamically -->
                </div>
            </div>
        </div>
    </main>
    <footer>
        <p>&copy; 2023 Akua Agyeiwaa | <a href="https://digitalhumanities.unl.edu" target="_blank">UNL Digital Humanities</a></p>
    </footer>
<!-- Add to body -->
<div class="share-buttons">
    <button class="share-button" onclick="share('twitter')">ùïè</button>
    <button class="share-button" onclick="share('facebook')">f</button>
    <button class="share-button" onclick="share('linkedin')">in</button>
</div>



<!-- Add to body -->
<div class="font-controls">
    <button class="font-button" onclick="adjustFontSize('decrease')">A-</button>
    <button class="font-button" onclick="adjustFontSize('reset')">A</button>
    <button class="font-button" onclick="adjustFontSize('increase')">A+</button>
</div>

<!-- Add to body -->
<button class="analytics-toggle" onclick="toggleAnalyticsDashboard()">üìä Analytics</button>
<div class="analytics-dashboard" id="analyticsDashboard">
    <h3>Reading Analytics</h3>
    <div class="analytics-chart" id="readingProgress"></div>
    <div class="analytics-chart" id="timeSpent"></div>
    <div class="analytics-chart" id="popularChapters"></div>
</div>

    <script>
        function openTab(evt, tabName) {
    var tabContents = document.getElementsByClassName("tab-content");
    for (var i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove("active");
    }

    var tabButtons = document.getElementsByClassName("tab-button");
    for (var i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove("active");
    }

    document.getElementById(tabName).classList.add("active");
    evt.currentTarget.classList.add("active");

    // Add this line to save the active tab
    localStorage.setItem('activeTab', tabName);
}

// Add this new function after your openTab function
function restoreActiveTab() {
    const activeTab = localStorage.getItem('activeTab');
    if (activeTab) {
        const tabButton = document.querySelector(`[onclick="openTab(event, '${activeTab}')"]`);
        if (tabButton) {
            tabButton.click();
        }
    }
}

// Add this line to call restoreActiveTab when the page loads
window.addEventListener('load', restoreActiveTab);

        // Accordion functionality
        const accordionHeaders = document.querySelectorAll(".accordion-header");

        accordionHeaders.forEach(header => {
            header.addEventListener("click", function() {
                this.classList.toggle("active");
                const content = this.nextElementSibling;

                // Close other open accordions
                accordionHeaders.forEach(otherHeader => {
                    if (otherHeader !== this && otherHeader.classList.contains("active")) {
                        otherHeader.classList.remove("active");
                        otherHeader.nextElementSibling.classList.remove("active");
                    }
                });

                content.classList.toggle("active");
            });
        });

        // Previous scripts remain the same

        // Google Translate initialization
        function googleTranslateElementInit() {
            new google.translate.TranslateElement(
                {pageLanguage: 'en'},
                'google_translate_element'
            );
        }

        // Read Aloud functionality
        let speechSynthesis = window.speechSynthesis;
        let utterance = null;
        let currentText = "";

        function startReading() {
            if (utterance && speechSynthesis.speaking) {
                speechSynthesis.resume();
            } else {
                currentText = document.getElementById('immersive-content').textContent;
                utterance = new SpeechSynthesisUtterance(currentText);
                speechSynthesis.speak(utterance);
            }
        }

        function pauseReading() {
            if (speechSynthesis.speaking) {
                speechSynthesis.pause();
            }
        }

        function stopReading() {
            speechSynthesis.cancel();
        }

        function changeReadingSpeed(speed) {
            if (utterance) {
                utterance.rate = parseFloat(speed);
                if (speechSynthesis.speaking) {
                    stopReading();
                    startReading();
                }
            }
        }

        // Search functionality
        function searchText() {
            const searchTerm = document.getElementById('search-box').value.toLowerCase();
            const content = document.getElementById('immersive-content').textContent;
            const results = [];

            // Simple search implementation
            const words = content.split(' ');
            for (let i = 0; i < words.length; i++) {
                if (words[i].toLowerCase().includes(searchTerm)) {
                    results.push({
                        word: words[i],
                        context: words.slice(Math.max(0, i-5), Math.min(words.length, i+5)).join(' ')
                    });
                }
            }

            // Display results
            const resultsDiv = document.getElementById('search-results');
            if (results.length > 0) {
                resultsDiv.innerHTML = results.map(result =>
                    `<p>...${result.context.replace(
                        new RegExp(searchTerm, 'gi'),
                        match => `<span class="highlight">${match}</span>`
                    )}...</p>`
                ).join('');
            } else {
                resultsDiv.innerHTML = '<p>No results found.</p>';
            }
        }

        // Function to load chapter content into immersive reader
        function loadChapterToImmersive(chapterContent) {
            document.getElementById('immersive-content').innerHTML = chapterContent;
        }

        // Add this to your accordion click handlers
        document.querySelectorAll('.accordion-header').forEach(button => {
            button.addEventListener('click', () => {
                // Previous accordion functionality remains

                // Load content to immersive reader when chapter is opened
                const content = button.nextElementSibling.innerHTML;
                loadChapterToImmersive(content);
            });
        });
    </script>
    <!-- Add to scripts -->
<script>
    function toggleTheme() {
        const body = document.querySelector('body');
        const icon = document.getElementById('theme-icon');
        if (body.getAttribute('data-theme') === 'dark') {
            body.setAttribute('data-theme', 'light');
            icon.textContent = 'üåô';
        } else {
            body.setAttribute('data-theme', 'dark');
            icon.textContent = '‚òÄÔ∏è';
        }
    }
</script>
<!-- Add to scripts -->
<script>
    window.onscroll = function() {
        let winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        let height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        let scrolled = (winScroll / height) * 100;
        document.getElementById("readingProgress").style.width = scrolled + "%";
    };
</script>
<!-- Add to scripts -->
<script>
    function share(platform) {
        const url = encodeURIComponent(window.location.href);
        const title = encodeURIComponent(document.title);
        let shareUrl;

        switch(platform) {
            case 'twitter':
                shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
                break;
            case 'facebook':
                shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                break;
            case 'linkedin':
                shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
                break;
        }
        window.open(shareUrl, '_blank');
    }
</script>
<!-- Add to scripts -->

<!-- Add to scripts -->
<script>
    let currentFontSize = 16;
    function adjustFontSize(action) {
        const content = document.getElementById('immersive-content');
        switch(action) {
            case 'increase':
                currentFontSize = Math.min(currentFontSize + 2, 24);
                break;
            case 'decrease':
                currentFontSize = Math.max(currentFontSize - 2, 12);
                break;
            case 'reset':
                currentFontSize = 16;
                break;
        }
        content.style.fontSize = `${currentFontSize}px`;
    }
</script>
<!-- Add to scripts section -->
<script>
// Analytics Tracking Class
class NovelAnalytics {
    constructor() {
        this.startTime = new Date();
        this.readingStats = JSON.parse(localStorage.getItem('readingStats')) || {
            chaptersRead: {},
            totalTimeSpent: 0,
            lastVisit: null,
            readingProgress: {},
            bookmarks: []
        };
        this.currentChapter = null;
        this.isReading = false;
        this.setupTracking();
    }

    setupTracking() {
        // Track chapter views
        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', () => {
                this.trackChapterView(header.textContent);
            });
        });

        // Track reading time
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                this.pauseReading();
            } else {
                this.resumeReading();
            }
        });

        // Track scroll progress
        window.addEventListener('scroll', this.debounce(() => {
            this.trackReadingProgress();
        }, 500));

        // Save stats before user leaves
        window.addEventListener('beforeunload', () => {
            this.saveStats();
        });
    }

    trackChapterView(chapterName) {
        this.currentChapter = chapterName;
        if (!this.readingStats.chaptersRead[chapterName]) {
            this.readingStats.chaptersRead[chapterName] = {
                views: 0,
                timeSpent: 0,
                lastRead: null
            };
        }
        this.readingStats.chaptersRead[chapterName].views++;
        this.readingStats.chaptersRead[chapterName].lastRead = new Date().toISOString();

        // Send to Google Analytics
        gtag('event', 'chapter_view', {
            'chapter_name': chapterName
        });
    }

    trackReadingProgress() {
        if (!this.currentChapter || !this.isReading) return;

        const scrollPos = window.scrollY;
        const windowHeight = window.innerHeight;
        const docHeight = document.documentElement.scrollHeight;
        const progress = (scrollPos / (docHeight - windowHeight)) * 100;

        this.readingStats.readingProgress[this.currentChapter] = Math.round(progress);

        // Send to Google Analytics
        gtag('event', 'reading_progress', {
            'chapter_name': this.currentChapter,
            'progress': Math.round(progress)
        });
    }

    startReading() {
        this.isReading = true;
        this.startTime = new Date();
    }

    pauseReading() {
        if (!this.isReading) return;
        this.isReading = false;
        this.updateTimeSpent();
    }

    resumeReading() {
        this.startReading();
    }

    updateTimeSpent() {
        if (!this.currentChapter) return;

        const timeSpent = (new Date() - this.startTime) / 1000; // in seconds
        this.readingStats.chaptersRead[this.currentChapter].timeSpent += timeSpent;
        this.readingStats.totalTimeSpent += timeSpent;

        // Send to Google Analytics
        gtag('event', 'reading_time', {
            'chapter_name': this.currentChapter,
            'time_spent': timeSpent
        });
    }

    saveStats() {
        this.readingStats.lastVisit = new Date().toISOString();
        localStorage.setItem('readingStats', JSON.stringify(this.readingStats));
    }

    getAnalytics() {
        return {
            totalTimeSpent: this.formatTime(this.readingStats.totalTimeSpent),
            mostReadChapter: this.getMostReadChapter(),
            averageProgress: this.getAverageProgress(),
            chapterStats: this.readingStats.chaptersRead
        };
    }

    getMostReadChapter() {
        return Object.entries(this.readingStats.chaptersRead)
            .sort(([,a], [,b]) => b.views - a.views)[0]?.[0] || 'None';
    }

    getAverageProgress() {
        const progresses = Object.values(this.readingStats.readingProgress);
        return progresses.length
            ? Math.round(progresses.reduce((a, b) => a + b, 0) / progresses.length)
            : 0;
    }

    formatTime(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        return `${hours}h ${
